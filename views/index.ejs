<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="format-detection" content="telephone=no">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ourStory</title>

    <meta name="author" content="ourStory">
    <link rel="canonical" href="https://loveforourlove.herokuapp.com/" />
    <meta name="robots" content="index, follow">
    <meta name="title" content="ourStory">
<!--     <meta name="description" content="우리들의 소중한 추억을 남기자"> -->
    <meta name="keywords" content="커플,계획,추억">
    <meta property="og:type" content="website" />
    <meta property="og:title" content="ourStory" />
    <meta property="og:description" content="우리들의 소중한 추억을 남기자" />
    <meta property="og:site_name" content="ourStory">
   


    <link rel="stylesheet" href="./css/style.css">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    <script
    src="https://code.jquery.com/jquery-3.6.0.js"
    integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk="
    crossorigin="anonymous"></script>
    <script src="https://cdn.tailwindcss.com"></script> 



    <style>
       @import url('https://fonts.googleapis.com/css2?family=Black+Han+Sans&family=Orbitron:wght@600&display=swap');
        #upAndDown{
            animation: up_down 2s linear infinite;
        }

        @keyframes up_down{
            0% {transform: translateY(0)}
            50% {transform: translateY(-14px)}
            100% {transform: translateY(0)}
        }

        .ellipsis{
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 1; 
            -webkit-box-orient: vertical;
        } 

      
        .swiper-wrapper {
            width: 400px !important;
           
            height: 400px !important;
           
        }
      
        .swiper-slide > img {
            width: 100%;
            height: 100%;
        }

        #popup {
            display: none;
        }
        .position {
            position : absolute;
            left : 50%;
            top : 50%;
            transform : translate(-50% , -50%)
        }

        #cancel {
            position : absolute;
            left : 50%;
            top : -23%;
            transform : translateX(-50%);
            vertical-align: middle;
           
        }
        #cancel > i {
            font-size : 24px;
            vertical-align: middle;
        }

        @media screen and (max-width: 410px) {
            #inputHidden {
            display :none
            }
            #flexChange {
                justify-content: space-between;
            }
        }
        .clock {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translateX(-50%) translateY(-50%);
            color: #17D4FE;
            font-size: 20px;
            font-family: 'Orbitron', sans-serif;
            letter-spacing: 7px;
        }

        @keyframes shake{
                0%{
                    transform: rotate(0deg);
                }
                10%{
                    transform: rotate(35deg);
                }
                20%{
                    transform: rotate(-35deg);
                }
                30%{
                    transform: rotate(20deg);
                }
                40%{
                    transform: rotate(-20deg);
                }
                50%{
                    transform: rotate(5deg);
                }
                60%{
                    transform: rotate(-5deg);
                }
                70%{
                    transform: rotate(0deg);
                }
                100%{
                    transform: rotate(0deg);
                }
        }


        #calendar {
            animation: shake 1.5s ease-in-out infinite;
        }

        #popupPlace {
            position: absolute;
            left: 70%;
            top: -25px;
            transform: translateX(-50%);
            animation: blink 1.5s ease-in infinite;
            display: block;
            width: 82px;
        }

        .read {
            background-color: #eee !important;
            background-image: url('./img/checkread.png');
            background-size: 20px 20px;
            background-repeat: no-repeat;
            background-position: 35% 14%;
            opacity: 0.8;
        }

        @keyframes blink {
            from {
                opacity: 0;
            }to {
                opacity: 1;
            }
        }
    </style>

   
    <link
    rel="stylesheet"
    href="https://unpkg.com/swiper@8/swiper-bundle.min.css"
    />

    <script src="https://unpkg.com/swiper@8/swiper-bundle.min.js"></script>

</head>
<body class="bg-slate-400">

    <div class="fixed z-20 w-screen h-full left-0 top-0 bg-black opacity-80" id="popup">
        
        <div class="bg-white w-5/6 p-7 opacity-none z-100 rounded-2xl shadow-xl position">
            <span class="text-sky-500 dark:text-sky-400 font-bold">
                <div class="input-group relative flex flex-wrap items-stretch xl:w-96 rounded">

                    <input type="text" id="keyword" class="placeholder-sky-400 form-control relative flex-auto min-w-0 block w-1/2 px-3 py-1.5 text-sm font-normal text-sky-400 bg-white bg-clip-padding border border-solid border-sky-400 rounded transition ease-in-out m-0 focus:text-sky-700 focus:bg-white focus:border-sky-700 focus:outline-none" placeholder="검색을해주세요." aria-label="Search" aria-describedby="button-addon2" onkeyup="chkText(this)">

                    <span onclick="search();" class="input-group-text flex items-center px-3 py-1.5 text-base font-normal text-sky-400 text-center whitespace-nowrap rounded" id="basic-addon2">
                      <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="w-4" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                        <path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path>
                      </svg>
                    </span >
                  </div>
            </span>

            <span class="text-sky-500 dark:text-sky-400 font-base ">
                <strong class="text-sky-500 dark:text-sky-600 font-bold p-1 my-1 block">최근 검색어</strong>
                <ul class="border border-solid border-sky-400 rounded-2xl shadow-xl p-2">
                    <% if(searchData.length === 0){%>
                            <li class="my-1.2 text-xs">최근 검색이 없습니다.</li>
                    <%}else{ %>
                        <% for(let list of searchData ){%>
                            <li class="my-1.2 text-xs"><%= list.search %></li>
                        <%}%>
                    <%}%>
                    
                </ul>    
            <span>


            <span class="bg-white rounded-2xl shadow-xl text-center" id="cancel">
                <i class="fa-solid fa-xmark text-xs p-2.5 pointer"></i>
            </span>

        </div>
    </div>

    <div class="fixed top-20 right-6 shadow-xl bg-amber-500 p-3 w-14 h-14 flex justify-center items-center z-10 rounded-full text-white transition-colors hover:bg-orange-500">
        <a href="/map" class="cursor-pointer"><i class="fa-solid fa-street-view" style="font-size: 24px;"></i></a>
        <span id="popupPlace" class="text-sm font-bold text-yellow-500">맛집 찾기</span>
    </div>
 



    <div class="bg-slate-400 py-10 px-4 flex flex-col h-full space-y-5 mt-5" id="bg">


        <div class="bg-white w-full text-base font-medium py-3 px-3 fixed text-gray-700 border-b z-10 top-0 left-0 justify-around flex items-center" id="flexChange">
            <span class="text-sky-500 dark:text-sky-400 font-bold"><i class="fa-solid fa-heart-pulse"></i> 우리의 이야기</span>


            <span class="text-sky-500 dark:text-sky-400 font-bold" id="open_search">
                <div class="input-group relative flex flex-wrap items-stretch xl:w-72 rounded" style="width: 90% !important">

                    <input type="text" id="inputHidden" class="placeholder-sky-400 form-control relative  flex-auto min-w-0 block w-1/4 px-2 py-1 text-sm font-normal text-sky-400 bg-white bg-clip-padding border border-solid border-sky-400 rounded transition ease-in-out m-0 focus:text-sky-700 focus:bg-white focus:border-sky-700 focus:outline-none" placeholder="검색을해주세요." aria-label="Search" aria-describedby="button-addon2">

                    <span class="input-group-text flex items-center px-3 py-1.5 text-base font-normal text-sky-400 text-center whitespace-nowrap rounded" id="basic-addon2">
                      <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="w-4" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                        <path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path>
                      </svg>
                    </span >
                  </div>
            </span>
        </div>

        



        <div class="bg-white p-5 rounded-2xl shadow-xl">
            <div class="text-sm text-gray-700 font-semibold text-center mb-2">오늘의 좋은글 <br /> <i class="fa-solid fa-book-open-reader"></i></div>
            <div class="font-bold italic" id="quotes">
                <span class="py-3"></span>
                <span class="block p-3 text-sm"></span>
            </div>
        </div>

        
        
        
        <div class="bg-white p-5 rounded-2xl shadow-xl">
            <div class="swiper mySwiper">
                <div class="swiper-wrapper">
                  <div class="swiper-slide"><img src="../img/s1.jpg" alt=""></div>
                  <div class="swiper-slide"><img src="../img/s2.jpg" alt=""></div>
                  <div class="swiper-slide"><img src="../img/s3.jpg" alt=""></div>
                  <div class="swiper-slide"><img src="../img/s4.jpg" alt=""></div>
               
                </div>
                <div class="swiper-button-next invisible"></div>
                <div class="swiper-button-prev invisible"></div>
                <div class="swiper-pagination invisible"></div>
              </div>
        </div>




        
        <div class="bg-white p-5 rounded-2xl shadow-xl flex justify-around items-center" id="upAndDown">
            <span class="h-24 w-24 bg-red-400 rounded-full overflow-hidden"><img src="./img/1.jpg" alt="img" class="w-full h-full"></span>
            <span class="text-slate-700 dark:text-slate-500 font-medium text-xs mx-2 text-center" >우리의 계획 <br /> 민영아 사랑해 <br /><i class="fa-solid fa-heart-pulse py-1" style="font-size: 18px;" ></i></span>
            <span class="h-24 w-24 bg-red-400 rounded-full overflow-hidden"><img src="./img/2.jpg" alt="img" class="w-full h-full"></span>
        </div>

        <div class="bg-white p-5 rounded-2xl shadow-xl">
                
            <div class="text-gray-700 font-bold py-3 text-center text-lg" id="calendar">
                <a href="/calendar" class="block w-full">달력 바로가기 <i class="fa-regular fa-calendar-days"></i></a>
            </div>
          
        </div>

        <div class="bg-white p-7 rounded-2xl shadow-xl relative">
            <div id="MyClockDisplay" class="clock w-full text-center ">
                <span class="first "></span>
                <span class="second " ></span>
                <span class="third"></span>
            </div>
        </div>


        <% if(listData.length <= 0){%>
            <div class="bg-white p-5 rounded-2xl shadow-xl">
                
                <div class="text-gray-700 font-bold py-3 text-center">
                    새로운 글이 없습니다.
                </div>
              
            </div>
        <%}else{%>
            <% for(let list of listData){ %>
                <div class="bg-white p-5 rounded-2xl shadow-xl" id="topLine" no="<%= list.slug %>">
                    <div class="flex justify-between items-center">
                        <div class="w-1/2">
                            <h3><span class="ellipsis font-bold"> <%= list.title %> </span></h3>
                        </div>
                        <div class="w-2/3 text-right">
                            <span class="text-xs "><%= list.createAt.toLocaleDateString('ko-KR', {
                                year: 'numeric',
                                month: 'long',
                                day: 'numeric',
                                hour : '2-digit',
                                minute : '2-digit'
                              }) %></span>
                        </div>
                    </div>
                    <div class="text-gray-700 font-bold py-3 cursor-pointer" onclick="saveLocal('<%= list.slug%>');">
                        <% if(list.snippet){ %>
                            <%= list.snippet %>
                        <% }else{ %>
                            <%= list.content %>
                        <% } %>
                      
                    </div>
                    <div class="text-left">
                        <span class="text-xs font-bold">작성자 : <span class="text-base font-bold"><%= list?.writer?.nickName %></span></span>
                    </div>
                    <div class="text-right">
                        <span><a href="/updatePlan/<%= list.slug %>" class="bg-blue-500 text-xs hover:bg-blue-400 text-white font-bold py-2 px-2 border-b-3 border-blue-700 hover:border-blue-500 rounded">글수정</a></span>
                    </div>
                </div>
            <% } %>
        <%}%>
        <div class="bg-white p-5 rounded-2xl shadow-xl">
            <nav aria-label="Page navigation example" style="text-align: center !important;">
                <ul class="inline-flex -space-x-px text-xs">

                    <% if(currentPage > 1){%>
                        <li>
                        <a href="?page=<%= currentPage-1 %>&title=<%= title %>" class="py-2 px-3 ml-0 leading-tight text-gray-500 bg-white rounded-l-lg border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white"> Previous </a>
                        </li>
                    <%}else{%>
                        <li>
                        <a href="" style="display: none;">뒤로 안보이기</a>  
                        </li>
                    <%}%>
               
                <% for(let i = startPage; i <= endPage ; i++){%>
                    <% if(i === currentPage ){%>
                        <li>
                            <a href="?page=<%= i %>&title=<%= title %>" aria-current="page" class="py-2 px-3 text-blue-600 bg-blue-50 border border-gray-300 hover:bg-blue-100 hover:text-blue-700 dark:border-gray-700 dark:bg-gray-700 dark:text-white"><%= i %></a>
                        </li>
                    <%}else{%>
                        <li>
                            <a href="/?page=<%= i %>&title=<%= title %>" class="py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white"><%= i %></a>
                        </li>
                    <%} %>
                 <%}%>
                        

                 <% if(currentPage < totalPage){%>
                    <li>
                        <a href="?page=<%= currentPage +1 %>&title=<%= title %>" class="py-2 px-3 leading-tight text-gray-500 bg-white rounded-r-lg border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">Next</a>
                    </li>
                <%}else{%>
                    <li>
                        <a href="" style="display: none;">앞으로 안보이기</a> 
                    </li>
                <%}%>
              
                </ul>
            </nav>
        </div>

        <div class="fixed bottom-24 right-6 shadow-xl bg-orange-400 p-3 w-14 h-14 flex justify-center items-center z-10 rounded-full text-white transition-colors hover:bg-orange-500">
            <a href="/insertPlan" class="cursor-pointer"><i class="fa fa-plus" style="font-size: 24px;" ></i></a>
        </div>
        <div class="fixed bottom-24 left-6 shadow-xl bg-orange-400 p-3 w-14 h-14 flex justify-center items-center z-10 rounded-full text-white transition-colors hover:bg-orange-500">
            <a href="/story/storylist" class="cursor-pointer"><i class="fa-solid fa-hard-drive" style="font-size: 24px;" ></i></a>
        </div>

    </div>



    <script src="./js/quotes.js"></script>  
    <script src="/js/time.js"></script>
    <script>
      let page = '<%= page %>'


    $('#open_search').click(function(){
        $('#popup').fadeIn(500)

        $('#bg').addClass('blur-lg')
    })

    $('#cancel').click(function(){
        $('#popup').fadeOut(200)
        $('#bg').removeClass('blur-lg')
    })


      var swiper = new Swiper(".mySwiper", {
        slidesPerView : 1,
        slidesPerGroup : 1, 
        spaceBetween: 30,
        centeredSlides: true,
        autoplay: {
          delay: 3000,
          disableOnInteraction: false,
        },
        pagination: {
          el: ".swiper-pagination",
          clickable: true,
        },
        navigation: {
          nextEl: ".swiper-button-next",
          prevEl: ".swiper-button-prev",
        },
      });


      
      /* window.onload = function(){
            const top = document.getElementById('topLine')
            const height = document.getElementById('upAndDown')

            const findTop = top.offsetTop;
            const findHeight = height.clientHeight;

            window.scrollTo({
                top : findTop - findHeight * 1.7,
                behavior : "smooth",
            })
      } */

     

      
      function chkText(text){
            let spaceRegExp =  /\s/g;
            let RegExp = /[\{\}\[\]\/?.,;:|\)*~`!^\-_+┼<>@\#$%&\'\"\\\(\=]/gi;
            const value =  text.value   

            if(spaceRegExp.test(value)){
                alert("공백이 포함되어 있습니다.")
                text.value = ""
                return false
            }

            if(RegExp.test(value)){
                alert("특수문자가 포함되어 있습니다. 자동처리 됩니다.")
                value = value.replace(RegExp , '');
                return false
            }
      }


      function search(){
        page = 1
        let keyword =  $('#keyword').val();
        if(keyword === ""){
            alert("검색어를 입력해주세요.")
            $('#keyword').focus();
            return false
        }

        $.ajax({
            url : "/insertSearch",
            type : "POST",
            dataType : "json",
            data : {
                keyword
            },
            success : function(data){
                console.log("data" , data)
            },
            error : function(err){
                console.log("Error" , err)
            }
        })

        window.location.href= `/?page=${page}&title=${keyword}`
      }

      //save localStorage 
      function saveLocal(id){

        //localStorage slug 없다면 빈배열생성
        if(!localStorage.getItem('slug')){
            localStorage.setItem('slug', '[]')
        }

        //localStorage 빈배열 가져와서 새로운 값 넣기
        let slugList = JSON.parse(localStorage.getItem('slug'));

        slugList.push(id)

        //slug 배열 중복 제거
        const removeSameId = [...new Set(slugList)]
      
        
        //localStorage slug 셋팅
        localStorage.setItem('slug', JSON.stringify(removeSameId))

       

        window.location.href = `/detailPlan/${id}` 
        
      }

      window.addEventListener('DOMContentLoaded', function(){
        const localSavedId = JSON.parse(localStorage.getItem('slug'));

        const listId = document.querySelectorAll('#topLine')
        

        for(let i = 0; i < listId.length; i++){
            const listIdVal = listId[i].getAttribute('no');
            for(let j = 0; j < localSavedId.length; j++){
                const localIdVal = localSavedId[j];

                if(listIdVal === localIdVal){
                    console.log("listId[i]" , listId[i])
                    listId[i].classList.add('read')
                }
            }
        }
      })

    </script>
</body>
</html>